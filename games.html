<!-- games.html -->
<head>
  <title>One Night Werewolf</title>
</head>

<body>
  <div class="container">
    <header>
      <h1>One Night Werewolf</h1>
      {{> loginButtons}}
    </header>

    <ul class="list-inline">
      <li>Users</li>
      {{#each users}}
        <li> {{username}} </li>
      {{/each}}
    </ul>
    {{#if currentUser}}
      <ul class="list-unstyled">
        <li><table class="table table-bordered">
          <tr>
            <th>State</th>
            <th>Roles</th>
            <th>Day Timer</th>
            <th>Num Players</th>
            <th></th> <!-- join/leave -->
            <th></th> <!-- start -->
            <th></th> <!-- delete -->
          </tr>
          {{#each games}}
            <tr>
              <td>{{gameState}}</td>
              <td>
              {{#each game_roles}}
                {{shortRoleName}}
              {{/each}}
              </td>
              <td>None</td>
              <td>TBD</td>
              <td>
                {{#if isPlayingThisGame}}
                  <button class="toggle-join btn btn-info" data-toggle="tooltip" title="Leave Game">
                  <span class="glyphicon glyphicon-minus"></span>
                  </button>
                {{else}}
                  <button class="toggle-join btn btn-info" data-toggle="tooltip" title="Join Game">
                  <span class="glyphicon glyphicon-plus"></span>
                  </button>
                {{/if}}
              </td>
              <td><button class="start-game btn btn-info" data-toggle="tooltip" title="Start Game"><span class="glyphicon glyphicon-play"></span></button></td>
              <td><button class="delete-game btn btn-info" data-toggle="tooltip" title="Delete Game"><span class="glyphicon glyphicon-remove"></span></button></td>
            </tr>
          {{/each}}
        </table>
        <button class="add-game btn btn-info" data-toggle="tooltip" title="Create New Game"><span class="glyphicon glyphicon-plus"></span> New Game</button></li>
        {{#each games}}
          {{#if isPlayingThisGame}}
            {{>showGame}}
          {{/if}}
        {{/each}}
      </ul>
    {{/if}}
  </div>
</body>

<template name="showGame">
  <li> Players:
  {{#each players}}
    {{username}}
  {{/each}}
  </li>

  <li> Add Role:
  {{#each all_roles}}
    <button class="add-role btn btn-default" data-game="{{../_id}}">{{name}}</button>
  {{/each}}
  </li>

  <li>Current Roles:
  {{#each game_roles}}
    <button class="delete-role btn btn-default">{{name}}</button>
  {{/each}}
  </li>

  {{>fullGameState}}
  {{#if gameStateNotCreating}}
    {{#if myRole "Seer"    }} {{> seerNight  }} {{/if}}
    {{#if myRole "Werewolf"}} {{> wolfNight  }} {{/if}}
    {{#if myRole "Robber"  }} {{> robberNight}} {{/if}}
  {{/if}}

  {{#if gameStateTest "eq" "Day"}}
    <li>{{>vote}}</li>
  {{/if}}
</template>

<template name="fullGameState">
  <li>State: {{gameState}}</li>
  {{#if gameStateNotCreating}}
    <li>My Role: {{myRole}}</li>
    {{#if myinfo.example_game}}
      <li><table class="table table-bordered">
        <tr>
          <th>Name</th>
          <th>Original Role</th>
          <th>Final Role</th>
          <th>Night Actions</th>
          <th>Voted For</th>
          <th>Votes Against</th>
          <th>Result</th>
        </tr>
        {{#each players}}
          <tr>
            <td>{{username}}</td>
            <td>{{myinfo.orig_role}}</td>
            <td>{{myinfo.curr_role}}</td>
            <td>{{debugResults}}</td>
            <td>{{gamePlayerId_username myinfo.voted_for}}</td>
            <td>{{myinfo.received_votes}}</td>
            <td>TBD {{win}}</td>
          </tr>
        {{/each}}
        {{mostVotedPlayers}}
      </table></li>
      <li>
      Unused Roles:
      {{#each myinfo.unused_roles}}
        {{name}}
      {{/each}}
      </li>
    {{/if}}
  {{/if}}
</template>

<template name="seerNight">
  <li>
    Seer Night Actions: <br>
    You are the Seer. Pick One player to Peek, or 2 cards from the middle. <br>
    Players:
    <form id="seerform">
      {{#each otherPlayers}}
        {{>pickPlayer}}
      {{/each}}
      <input type="radio" name="player" value="middle" checked>2 cards from the middle
      <button type="submit" class="btn btn-primary">Submit</button>
    </form>
    <br>
    {{seerResults}}
  </li>
</template>

<template name="robberNight">
  <li>
    Robber Night Actions: <br>
    You are the Robber. Pick One player to Rob, or choose "Do not rob". <br>
    Players:
    <form id="robberform">
      {{#each otherPlayers}}
        {{>pickPlayer}}
      {{/each}}
      <input type="radio" name="player" value="nobody" checked>Do not rob
      <button type="submit" class="btn btn-primary">Submit</button>
    </form>
    <br>
    {{robberResults}}
  </li>
</template>

<template name="wolfNight">
  <li>
    Wolf Night Actions:<br>
    {{wolfNightScript}}
  </li>
</template>

<template name="vote">
  <form id="voteform">
    Vote:<br>
    {{#each otherPlayers}}
      <input type="radio" name="voteplayer" value="{{this._id}}">{{username}}
    {{/each}}
    <input type="radio" name="voteplayer" value="nobody" checked>Continue Daytime
    <button type="submit" class="btn btn-primary">Submit</button>
  </form>
</template>

<template name="pickPlayer">
  <input type="radio" name="player" value="{{this._id}}">{{username}}
</template>
