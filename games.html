<!-- games.html -->
<head>
  <title>One Night Werewolf</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
</head>

<template name="appBody">
  <div class="container">
    <header>
      <h1>One Night Werewolf</h1>
      {{> loginButtons}}
    </header>
    {{> yield}}
  </div>
</template>

<template name="home">
  <ul class="list-inline">
    <li>Users</li>
    {{#each findAllUsers}}
      <li> {{username}} </li>
    {{/each}}
  </ul>
  {{#if currentUser}}
    <ul class="list-unstyled">
      <li><table class="table table-bordered">
        <tr>
          <th width="10%"                  >State</th>
          <th width="30%"                  >Roles</th>
          <th width="10%" class="hidden-xs">Day Timer</th>
          <th width="10%" class="hidden-xs">Num Players</th>
          <th width="20%"                  ></th> <!-- action buttons -->
        </tr>
        {{#each findAllGames}}
          <tr>
            <td>{{gameState}}</td>
            <td>
            {{#each game_roles}}
              {{shortRoleName}}
            {{/each}}
            </td>
            <td class="hidden-xs">None</td>
            <td class="hidden-xs">TBD</td>
            <td>
              {{#if isPlayingThisGame}}
                <button class="toggle-join btn btn-info" data-toggle="tooltip" title="Leave Game">
                <span class="glyphicon glyphicon-minus"></span>
                </button>
              {{else}}
                <button class="toggle-join btn btn-info" data-toggle="tooltip" title="Join Game">
                <span class="glyphicon glyphicon-plus"></span>
                </button>
              {{/if}}
              {{#if isOwnerThisGame}}
                <button class="start-game btn btn-info" data-toggle="tooltip" title="Start Game"><span class="glyphicon glyphicon-play"></span></button>
                <button class="delete-game btn btn-info" data-toggle="tooltip" title="Delete Game"><span class="glyphicon glyphicon-remove"></span></button>
              {{/if}}
            </td>
          </tr>
        {{/each}}
      </table>
      <button class="add-game btn btn-info" data-toggle="tooltip" title="Create New Game"><span class="glyphicon glyphicon-plus"></span> New Game</button></li>
      {{#each findAllGames}}
        {{#if isPlayingThisGame}}
          {{>showGame}}
        {{/if}}
      {{/each}}
    </ul>
  {{/if}}
</template>

<template name="about">
  <p>One Night Werewolf</p>
  <p>Version: 0.1</p>
</template>

<template name="showGame">
  <li> Players:
  {{#each players}}
    {{username}}
  {{/each}}
  </li>

  {{#if isOwnerThisGame}}
  {{#if gameStateTest "eq" "Creating"}}
    <li> Add Role:
    {{#each all_roles}}
      <button class="add-role btn btn-default" data-game="{{../_id}}">{{name}}</button>
    {{/each}}
    </li>
  {{/if}}
  {{/if}}

  <li>Current Roles:
  {{#each game_roles}}
    <button class="delete-role btn btn-default">{{name}}</button>
  {{/each}}
  </li>

  {{>fullGameState}}

  {{#if gameStateTest "eq" "Night"}}
    {{#if myRole "Seer"    }} {{> seerNight  }} {{/if}}
    {{#if myRole "Werewolf"}} {{> wolfNight  }} {{/if}}
    {{#if myRole "Robber"  }} {{> robberNight}} {{/if}}
  {{/if}}

  {{#if gameStateTest "eq" "Day"}}
    <li>{{>vote}}</li>
  {{/if}}
</template>

<template name="fullGameState">
  <li>State: {{gameState}}</li>
  {{#if gameStateNotCreating}}
    <li>You are a <strong>{{myRole}}</strong> at Night {{myDebugResults}}</li>
    {{#if showAllInfo}}
      <li><table class="table table-bordered">
        <tr>
          <th width="10%"                  >Name</th>
          <th width="10%"                  >Original Role</th>
          <th width="10%"                  >Final Role</th>
          <th width="20%" class="hidden-xs">Night Actions</th>
          <th width="10%" class="hidden-xs">Voted For</th>
          <th width="5%"                   >#V</th>
        </tr>
        {{#if gameStateTest "eq" "Done"}}
          {{#each players}}
            {{#if myinfo.won}}
              <tr class="success">
                {{>fullPlayerInfoRow}}
              </tr>
            {{else}}
              <tr class="danger">
                {{>fullPlayerInfoRow}}
              </tr>
            {{/if}}
          {{/each}}
        {{else}}
          {{#each players}}
            <tr>
              {{>fullPlayerInfoRow}}
            </tr>
          {{/each}}
        {{/if}}
        {{mostVotedPlayers}}
      </table></li>
      <li>
      Unused Roles:
      {{#each myinfo.unused_roles}}
        {{name}}
      {{/each}}
      </li>
    {{/if}}
  {{/if}}
</template>

<template name="fullPlayerInfoRow">
  <td width="10%"                  >{{username}}</td>
  <td width="10%"                  >{{myinfo.orig_role}}</td>
  <td width="10%"                  >{{myinfo.curr_role}}</td>
  <td width="20%" class="hidden-xs">{{debugResults}}</td>
  <td width="10%" class="hidden-xs">{{gamePlayerId_username myinfo.voted_for}}</td>
  <td width="5%"                   >{{myinfo.received_votes}}</td>
</template>

<template name="seerNight">
  <li>
    Seer Night Actions: <br>
    You are the Seer. Pick One player to Peek, or 2 cards from the middle. <br>
    Players:
    <form id="seerform">
      {{#each otherPlayers}}
        {{>pickPlayer}}
      {{/each}}
      <input type="radio" name="player" value="middle" checked>2 cards from the middle
      <button type="submit" class="btn btn-primary">Submit</button>
    </form>
    <br>
  </li>
</template>

<template name="robberNight">
  <li>
    Robber Night Actions: <br>
    You are the Robber. Pick One player to Rob, or choose "Do not rob". <br>
    Players:
    <form id="robberform">
      {{#each otherPlayers}}
        {{>pickPlayer}}
      {{/each}}
      <input type="radio" name="player" value="nobody" checked>Do not rob
      <button type="submit" class="btn btn-primary">Submit</button>
    </form>
    <br>
  </li>
</template>

<template name="wolfNight">
  <li>
    Wolf Night Actions:<br>
    {{wolfNightScript}}
  </li>
</template>

<template name="vote">
  <form id="voteform">
    Vote:<br>
    {{#each otherPlayers}}
      <input type="radio" name="voteplayer" value="{{this._id}}">{{username}}
    {{/each}}
    <input type="radio" name="voteplayer" value="nobody" checked>Continue Daytime
    <button type="submit" class="btn btn-primary">Submit</button>
  </form>
</template>

<template name="pickPlayer">
  <input type="radio" name="player" value="{{this._id}}">{{username}}
</template>

