<!-- games.html -->
<head>
  <title>One Night Werewolf</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
</head>

<template name="appBody">
  <div class="container">
    <!--
    <nav class="navbar navbar-default" role="navigation">
      <div class="nav navbar-nav">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
      </div>
      <ul class="nav navbar-nav navbar-left">
        <li><a class="navbar-brand" href="#">ONW</a></li>
      </ul>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav navbar-left">
          <li><a href="/" padding="0">Home</a></li>
          <li><a href="/about" padding-top="0" padding-bottom="0">About</a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li><a href="#">{{> loginButtons align="right"}}</a></li>
        </ul>
      </div>
    </nav>
    -->
    <ul class="list-inline">
      <li><a href="#">{{> loginButtons}}</a></li>
      <li><a href="/" padding="0">Home</a></li>
      <li><a href="/about" padding-top="0" padding-bottom="0">About</a></li>
    </ul>
    {{> yield}}
  </div>
</template>

<template name="home">
  {{#if currentUser}}
    <table class="table table-bordered">
      <caption>Current games</caption>
      <tr>
        <th width="10%"                  >State</th>
        <th width="30%"                  >Roles</th>
        <th width="10%" class="hidden-xs">Day Timer</th>
        <th width="10%" class="hidden-xs">Num Players</th>
        <th width="20%"                  ></th> <!-- action buttons -->
      </tr>
      {{#each findAllGames}}
        <tr>
          <td>{{gameState}}</td>
          <td>
          {{#each game_roles}}
            {{shortRoleName}}
          {{/each}}
          </td>
          <td class="hidden-xs">None</td>
          <td class="hidden-xs">{{daytimer}}</td>
          <td>
            <a href="/game/{{_id}}">
            <button class="open-game btn btn-info" data-toggle="tooltip" title="Join Game Room">
            <span class="glyphicon glyphicon-plus"></span>
            </button>
            </a>
          </td>
        </tr>
      {{/each}}
    </table>
    <button class="add-game btn btn-info" data-toggle="tooltip" title="Create New Game"><span class="glyphicon glyphicon-plus"></span> New Game</button>
    {{>userList}}
  {{/if}}
</template>

<template name="userList">
  <ul class="list-inline">
    <li>Users</li>
    {{#each onlineUsers}}
      <li> {{username}} </li>
    {{/each}}
  </ul>
</template>

<template name="about">
  <p>One Night Werewolf</p>
  <p>Version: 0.1</p>
</template>

<template name="showGame">
  {{#if nightTransition}}
    {{>nightTransitionModal}}
  {{/if}}
  {{#if gameState}}
    <table id="showGame" class="table table-bordered">
      {{>gameStateActions}}
      {{>playerListT}}
      {{>addRolesT}}
      {{>listRolesT}}
      <tr><td>State</td>             <td>{{gameState}} {{timer}}</td></tr>
      <tr><td>Your original role</td><td>{{myRole}}</td></tr>
      <tr><td>Night Results</td>     <td>{{myNightResults}}</td></tr>
    </table>

    {{#if gameStateTest "Creating"}}
    {{else}}
      {{>userActions}}
    {{/if}}

    {{>gameResultTableLogicT}}

  {{else}}
    Game does not exist
  {{/if}}
</template>

<template name="gameResultTableLogicT">
  {{#if gameStateTest "Creating"}}
  {{else}}
    {{#if gameStateTest "Done"}}
      {{>gameResultTable}}
    {{else}}
      {{#if showAllInfo}}
        <div class="show-all-info">
          {{>gameResultTable}}
        </div>
      {{/if}}
    {{/if}}
  {{/if}}
</template>

<template name="gameStateActions">
  <tr>
  <td>Actions</td>
  <td>
  {{#if isOwnerThisGame}}
    <button class="start-game btn btn-info" data-toggle="tooltip" title="Start Game"><span class="glyphicon glyphicon-play"></span></button>
    <button class="delete-game btn btn-info" data-toggle="tooltip" title="Delete Game"><span class="glyphicon glyphicon-remove"></span></button>
  {{else}}
    {{#if gameStateTest "Creating"}}
      {{#if isPlayingThisGame}}
        <button class="toggle-join btn btn-info" data-toggle="tooltip" title="Leave Game">
        <span class="glyphicon glyphicon-minus"></span>
        </button>
      {{else}}
        <button class="toggle-join btn btn-info" data-toggle="tooltip" title="Join Game">
        <span class="glyphicon glyphicon-plus"></span>
        </button>
      {{/if}}
    {{else}}
      N/A
    {{/if}}
  {{/if}}
  </td>
  </tr>
</template>

<template name="playerListT">
  <tr><td>Players</td>
  <td>
  {{#each players}}
    {{username}}
  {{/each}}
  </td>
  </tr>
</template>


<template name="addRolesT">
  {{#if isOwnerThisGame}}
  {{#if gameStateTest "Creating"}}
    <tr><td>Add Role</td>
    <td>
    {{#each all_roles}}
      <button class="add-role btn btn-default" data-game="{{../_id}}">{{name}}</button>
    {{/each}}
    </td>
    </tr>
  {{/if}}
  {{/if}}
</template>

<template name="listRolesT">
  <tr><td>Game roles</td>
  <td>
    {{#if gameStateTest "Creating"}}
      {{#if isOwnerThisGame}}
        {{#each game_roles}}
          <button class="delete-role btn btn-default">{{name}}</button>
        {{/each}}
      {{else}}
        {{#each game_roles}}
          {{name}}
        {{/each}}
      {{/if}}
    {{else}}
      {{#each game_roles}}
        {{name}}
      {{/each}}
    {{/if}}
  </td></tr>
</template>


<template name="userActions">
  {{#if gameStateTest "Night"}}
    {{#if myNightDone}}
      <div class="user-attention">
      <p>Waiting for other players to finish their Night actions.</p>
      <p>Tip: {{randomTip}}</p>
      </div>
    {{else}}
      {{#if myRoleTest "Seer"    }} {{> seerNight  }} {{else}}
      {{#if myRoleTest "Robber"  }} {{> robberNight}} {{else}}
                                    {{> dummyNight}}
      {{/if}}
      {{/if}}
    {{/if}}
  {{/if}}

  {{#if gameStateTest "Day"}}
    <p>{{>vote}}</p>
  {{/if}}
</template>

<template name="nightTransitionModal">
  <div class="modal-dialog nightTransitionModal">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      header
    </div>
    <div class="modal-body">
      body
    </div>
  </div>
</template>

<template name="gameResultTable">
  <table class="table table-bordered">
    <tr>
      <th width="10%"                  >Name</th>
      <th width="10%"                  >Original Role</th>
      <th width="10%"                  >Final Role</th>
      <th width="20%" class="hidden-xs">Night Actions</th>
      <th width="10%" class="hidden-xs">Voted For</th>
      <th width="5%"                   >#V</th>
    </tr>
    {{#if gameStateTest "Done"}}
      {{#each players}}
        {{#if myinfo.won}}
          <tr class="success">
            {{>fullPlayerInfoRow}}
          </tr>
        {{else}}
          <tr class="danger">
            {{>fullPlayerInfoRow}}
          </tr>
        {{/if}}
      {{/each}}
    {{else}}
      {{#each players}}
        <tr>
          {{>fullPlayerInfoRow}}
        </tr>
      {{/each}}
    {{/if}}
    {{mostVotedPlayers}}
  </table>
  <p> Unused Roles:
    {{#each myinfo.unused_roles}}
      {{name}}
    {{/each}}
  </p>
</template>

<template name="fullPlayerInfoRow">
  <td width="10%"                  >{{username}}</td>
  <td width="10%"                  >{{myinfo.orig_role}}</td>
  <td width="10%"                  >{{myinfo.curr_role}}</td>
  <td width="20%" class="hidden-xs">{{thisNightResults}}</td>
  <td width="10%" class="hidden-xs">{{gamePlayerId_username myinfo.voted_for}}</td>
  <td width="5%"                   >{{myinfo.received_votes}}</td>
</template>

<template name="seerNight">
  <p>
    <form id="seerform">
      Pick One player to Peek, or 2 cards from the middle.
      <ul>
        {{#each otherPlayers}}
          <li><input type="radio" name="player" value="{{this._id}}">{{username}}</li>
        {{/each}}
        <li><input type="radio" name="player" value="middle" checked>2 cards from the middle</li>
        <li><button type="submit" class="btn btn-primary">Submit</button></li>
      </ul>
    </form>
    <br>
  </p>
</template>

<template name="robberNight">
  <p>
    <form id="robberform">
      Pick One player to Rob, or choose "Do not rob".
      <ul>
        {{#each otherPlayers}}
          <li><input type="radio" name="player" value="{{this._id}}">{{username}}</li>
        {{/each}}
        <li><input type="radio" name="player" value="nobody" checked>Do not rob</li>
        <li><button type="submit" class="btn btn-primary">Submit</button></li>
      </ul>
    </form>
    <br>
  </p>
</template>

<template name="dummyNight">
  <p>
    <form id="dummyform">
      {{myNightResults}}
      <ul>
        <li><button type="submit" class="btn btn-primary">Continue</button></li>
      </ul>
      Tip: {{randomTip}}
    </form>
    <br>
  </p>
</template>

<template name="vote">
  <form id="voteform">
    Vote for a player to kill
    <ul>
      {{#each otherPlayers}}
        <li><input type="radio" name="voteplayer" value="{{this._id}}">{{username}}</li>
      {{/each}}
      <li><input type="radio" name="voteplayer" value="nobody" checked>Continue daytime</li>
      <li><button type="submit" class="btn btn-primary">Submit</button></li>
    </ul>
    {{#if myVote}}
      <p>You voted for {{myVote}}.</p>
      <p>Daytime will continue until all players have voted, or the timer expires.</p>
    {{else}}
      You voted to continue daytime.
    {{/if}}
  </form>
</template>

